{"ast":null,"code":"'use strict';\n\nconst url = require('url');\n\nconst opentracing = require('opentracing');\n\nconst log = require('../../dd-trace/src/log');\n\nconst constants = require('../../dd-trace/src/constants');\n\nconst tags = require('../../../ext/tags');\n\nconst kinds = require('../../../ext/kinds');\n\nconst formats = require('../../../ext/formats');\n\nconst urlFilter = require('../../dd-trace/src/plugins/util/urlfilter');\n\nconst analyticsSampler = require('../../dd-trace/src/analytics_sampler');\n\nconst Reference = opentracing.Reference;\nconst HTTP_HEADERS = formats.HTTP_HEADERS;\nconst HTTP_STATUS_CODE = tags.HTTP_STATUS_CODE;\nconst HTTP_REQUEST_HEADERS = tags.HTTP_REQUEST_HEADERS;\nconst HTTP_RESPONSE_HEADERS = tags.HTTP_RESPONSE_HEADERS;\nconst SPAN_KIND = tags.SPAN_KIND;\nconst CLIENT = kinds.CLIENT;\nconst REFERENCE_CHILD_OF = opentracing.REFERENCE_CHILD_OF;\nconst REFERENCE_NOOP = constants.REFERENCE_NOOP;\n\nfunction patch(http, methodName, tracer, config) {\n  config = normalizeConfig(tracer, config);\n  this.wrap(http, methodName, fn => makeRequestTrace(fn));\n\n  function makeRequestTrace(request) {\n    return function requestTrace() {\n      let args;\n\n      try {\n        args = normalizeArgs.apply(null, arguments);\n      } catch (e) {\n        log.error(e);\n        return request.apply(this, arguments);\n      }\n\n      const options = args.options;\n      const agent = options.agent || options._defaultAgent || http.globalAgent;\n      const protocol = options.protocol || agent.protocol || 'http:';\n      const hostname = options.hostname || options.host || 'localhost';\n      const host = options.port ? `${hostname}:${options.port}` : hostname;\n      const path = options.path ? options.path.split(/[?#]/)[0] : '/';\n      const uri = `${protocol}//${host}${path}`;\n      let callback = args.callback;\n      const method = (options.method || 'GET').toUpperCase();\n      const scope = tracer.scope();\n      const childOf = scope.active();\n      const type = config.filter(uri) ? REFERENCE_CHILD_OF : REFERENCE_NOOP;\n      const span = tracer.startSpan('http.request', {\n        references: [new Reference(type, childOf)],\n        tags: {\n          [SPAN_KIND]: CLIENT,\n          'service.name': getServiceName(tracer, config, options),\n          'resource.name': method,\n          'span.type': 'http',\n          'http.method': method,\n          'http.url': uri\n        }\n      });\n\n      if (!(hasAmazonSignature(options) || !config.propagationFilter(uri))) {\n        tracer.inject(span, HTTP_HEADERS, options.headers);\n      }\n\n      analyticsSampler.sample(span, config.measured);\n      callback = scope.bind(callback, childOf);\n      const req = scope.bind(request, span).call(this, options, callback);\n      const emit = req.emit;\n\n      req.emit = function (eventName, arg) {\n        switch (eventName) {\n          case 'response':\n            {\n              const res = arg;\n              scope.bind(res);\n              res.on('end', () => finish(req, res, span, config));\n              break;\n            }\n\n          case 'error':\n            addError(span, arg);\n\n          case 'abort': // eslint-disable-line no-fallthrough\n\n          case 'timeout':\n            // eslint-disable-line no-fallthrough\n            finish(req, null, span, config);\n        }\n\n        return emit.apply(this, arguments);\n      };\n\n      scope.bind(req);\n      return req;\n    };\n  }\n\n  function finish(req, res, span, config) {\n    if (res) {\n      span.setTag(HTTP_STATUS_CODE, res.statusCode);\n\n      if (!config.validateStatus(res.statusCode)) {\n        span.setTag('error', 1);\n      }\n\n      addResponseHeaders(res, span, config);\n    } else {\n      span.setTag('error', 1);\n    }\n\n    addRequestHeaders(req, span, config);\n    config.hooks.request(span, req, res);\n    span.finish();\n  }\n\n  function addError(span, error) {\n    span.addTags({\n      'error.type': error.name,\n      'error.msg': error.message,\n      'error.stack': error.stack\n    });\n    return error;\n  }\n\n  function addRequestHeaders(req, span, config) {\n    config.headers.forEach(key => {\n      const value = req.getHeader(key);\n\n      if (value) {\n        span.setTag(`${HTTP_REQUEST_HEADERS}.${key}`, value);\n      }\n    });\n  }\n\n  function addResponseHeaders(res, span, config) {\n    config.headers.forEach(key => {\n      const value = res.headers[key];\n\n      if (value) {\n        span.setTag(`${HTTP_RESPONSE_HEADERS}.${key}`, value);\n      }\n    });\n  }\n\n  function normalizeArgs(inputURL, inputOptions, cb) {\n    inputURL = normalizeOptions(inputURL);\n    const [callback, inputOptionsNormalized] = normalizeCallback(inputOptions, cb, inputURL);\n    const options = combineOptions(inputURL, inputOptionsNormalized);\n    normalizeHeaders(options);\n    const uri = url.format(options);\n    return {\n      uri,\n      options,\n      callback\n    };\n  }\n\n  function normalizeCallback(inputOptions, callback, inputURL) {\n    if (typeof inputOptions === 'function') {\n      return [inputOptions, inputURL || {}];\n    } else {\n      return [callback, inputOptions];\n    }\n  }\n\n  function combineOptions(inputURL, inputOptions) {\n    if (typeof inputOptions === 'object') {\n      return Object.assign(inputURL || {}, inputOptions);\n    } else {\n      return inputURL;\n    }\n  }\n\n  function normalizeHeaders(options) {\n    options.headers = options.headers || {};\n  } // https://github.com/nodejs/node/blob/7e911d8b03a838e5ac6bb06c5b313533e89673ef/lib/internal/url.js#L1271\n\n\n  function urlToOptions(url) {\n    const agent = url.agent || http.globalAgent;\n    const options = {\n      protocol: url.protocol || agent.protocol,\n      hostname: typeof url.hostname === 'string' && url.hostname.startsWith('[') ? url.hostname.slice(1, -1) : url.hostname || url.host || 'localhost',\n      hash: url.hash,\n      search: url.search,\n      pathname: url.pathname,\n      path: `${url.pathname || ''}${url.search || ''}`,\n      href: url.href\n    };\n\n    if (url.port !== '') {\n      options.port = Number(url.port);\n    }\n\n    if (url.username || url.password) {\n      options.auth = `${url.username}:${url.password}`;\n    }\n\n    return options;\n  }\n\n  function normalizeOptions(inputURL) {\n    if (typeof inputURL === 'string') {\n      try {\n        return urlToOptions(new url.URL(inputURL));\n      } catch (e) {\n        return url.parse(inputURL);\n      }\n    } else if (inputURL instanceof url.URL) {\n      return urlToOptions(inputURL);\n    } else {\n      return inputURL;\n    }\n  }\n}\n\nfunction getHost(options) {\n  if (typeof options === 'string') {\n    return url.parse(options).host;\n  }\n\n  const hostname = options.hostname || options.host || 'localhost';\n  const port = options.port;\n  return [hostname, port].filter(val => val).join(':');\n}\n\nfunction getServiceName(tracer, config, options) {\n  if (config.splitByDomain) {\n    return getHost(options);\n  } else if (config.service) {\n    return config.service;\n  }\n\n  return `${tracer._service}-http-client`;\n}\n\nfunction hasAmazonSignature(options) {\n  if (!options) {\n    return false;\n  }\n\n  if (options.headers) {\n    const headers = Object.keys(options.headers).reduce((prev, next) => Object.assign(prev, {\n      [next.toLowerCase()]: options.headers[next]\n    }), {});\n\n    if (headers['x-amz-signature']) {\n      return true;\n    }\n\n    if ([].concat(headers['authorization']).some(startsWith('AWS4-HMAC-SHA256'))) {\n      return true;\n    }\n  }\n\n  return options.path && options.path.toLowerCase().indexOf('x-amz-signature=') !== -1;\n}\n\nfunction startsWith(searchString) {\n  return value => String(value).startsWith(searchString);\n}\n\nfunction unpatch(http) {\n  this.unwrap(http, 'request');\n  this.unwrap(http, 'get');\n}\n\nfunction getStatusValidator(config) {\n  if (typeof config.validateStatus === 'function') {\n    return config.validateStatus;\n  } else if (config.hasOwnProperty('validateStatus')) {\n    log.error('Expected `validateStatus` to be a function.');\n  }\n\n  return code => code < 400 || code >= 500;\n}\n\nfunction getFilter(tracer, config) {\n  const blocklist = tracer._url ? [getAgentFilter(tracer._url)] : [];\n  config = Object.assign({}, config, {\n    blocklist: blocklist.concat(config.blocklist || [])\n  });\n  return urlFilter.getFilter(config);\n}\n\nfunction getAgentFilter(url) {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Escaping\n  const agentFilter = url.href.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  return RegExp(`^${agentFilter}.*$`, 'i');\n}\n\nfunction normalizeConfig(tracer, config) {\n  config = config.client || config;\n  const validateStatus = getStatusValidator(config);\n  const filter = getFilter(tracer, config);\n  const propagationFilter = getFilter(tracer, {\n    blocklist: config.propagationBlocklist\n  });\n  const headers = getHeaders(config);\n  const hooks = getHooks(config);\n  return Object.assign({}, config, {\n    validateStatus,\n    filter,\n    propagationFilter,\n    headers,\n    hooks\n  });\n}\n\nfunction getHeaders(config) {\n  if (!Array.isArray(config.headers)) return [];\n  return config.headers.filter(key => typeof key === 'string').map(key => key.toLowerCase());\n}\n\nfunction getHooks(config) {\n  const noop = () => {};\n\n  const request = config.hooks && config.hooks.request || noop;\n  return {\n    request\n  };\n}\n\nmodule.exports = [{\n  name: 'http',\n  patch: function (http, tracer, config) {\n    if (config.client === false) return;\n    patch.call(this, http, 'request', tracer, config);\n    /**\n     * References internal to modules, such as `http(s).get` calling\n     * `http(s).request`, do not use externally patched versions, which is\n     * why we need to also patch `get` here separately.\n     */\n\n    patch.call(this, http, 'get', tracer, config);\n  },\n  unpatch\n}, {\n  name: 'https',\n  patch: function (http, tracer, config) {\n    if (config.client === false) return;\n    patch.call(this, http, 'request', tracer, config);\n    patch.call(this, http, 'get', tracer, config);\n  },\n  unpatch\n}];","map":{"version":3,"sources":["/Users/danielcalderon/vinology/Vinology-client/node_modules/dd-trace/packages/datadog-plugin-http/src/client.js"],"names":["url","require","opentracing","log","constants","tags","kinds","formats","urlFilter","analyticsSampler","Reference","HTTP_HEADERS","HTTP_STATUS_CODE","HTTP_REQUEST_HEADERS","HTTP_RESPONSE_HEADERS","SPAN_KIND","CLIENT","REFERENCE_CHILD_OF","REFERENCE_NOOP","patch","http","methodName","tracer","config","normalizeConfig","wrap","fn","makeRequestTrace","request","requestTrace","args","normalizeArgs","apply","arguments","e","error","options","agent","_defaultAgent","globalAgent","protocol","hostname","host","port","path","split","uri","callback","method","toUpperCase","scope","childOf","active","type","filter","span","startSpan","references","getServiceName","hasAmazonSignature","propagationFilter","inject","headers","sample","measured","bind","req","call","emit","eventName","arg","res","on","finish","addError","setTag","statusCode","validateStatus","addResponseHeaders","addRequestHeaders","hooks","addTags","name","message","stack","forEach","key","value","getHeader","inputURL","inputOptions","cb","normalizeOptions","inputOptionsNormalized","normalizeCallback","combineOptions","normalizeHeaders","format","Object","assign","urlToOptions","startsWith","slice","hash","search","pathname","href","Number","username","password","auth","URL","parse","getHost","val","join","splitByDomain","service","_service","keys","reduce","prev","next","toLowerCase","concat","some","indexOf","searchString","String","unpatch","unwrap","getStatusValidator","hasOwnProperty","code","getFilter","blocklist","_url","getAgentFilter","agentFilter","replace","RegExp","client","propagationBlocklist","getHeaders","getHooks","Array","isArray","map","noop","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst url = require('url')\nconst opentracing = require('opentracing')\nconst log = require('../../dd-trace/src/log')\nconst constants = require('../../dd-trace/src/constants')\nconst tags = require('../../../ext/tags')\nconst kinds = require('../../../ext/kinds')\nconst formats = require('../../../ext/formats')\nconst urlFilter = require('../../dd-trace/src/plugins/util/urlfilter')\nconst analyticsSampler = require('../../dd-trace/src/analytics_sampler')\n\nconst Reference = opentracing.Reference\n\nconst HTTP_HEADERS = formats.HTTP_HEADERS\nconst HTTP_STATUS_CODE = tags.HTTP_STATUS_CODE\nconst HTTP_REQUEST_HEADERS = tags.HTTP_REQUEST_HEADERS\nconst HTTP_RESPONSE_HEADERS = tags.HTTP_RESPONSE_HEADERS\nconst SPAN_KIND = tags.SPAN_KIND\nconst CLIENT = kinds.CLIENT\nconst REFERENCE_CHILD_OF = opentracing.REFERENCE_CHILD_OF\nconst REFERENCE_NOOP = constants.REFERENCE_NOOP\n\nfunction patch (http, methodName, tracer, config) {\n  config = normalizeConfig(tracer, config)\n  this.wrap(http, methodName, fn => makeRequestTrace(fn))\n\n  function makeRequestTrace (request) {\n    return function requestTrace () {\n      let args\n\n      try {\n        args = normalizeArgs.apply(null, arguments)\n      } catch (e) {\n        log.error(e)\n        return request.apply(this, arguments)\n      }\n\n      const options = args.options\n      const agent = options.agent || options._defaultAgent || http.globalAgent\n      const protocol = options.protocol || agent.protocol || 'http:'\n      const hostname = options.hostname || options.host || 'localhost'\n      const host = options.port ? `${hostname}:${options.port}` : hostname\n      const path = options.path ? options.path.split(/[?#]/)[0] : '/'\n      const uri = `${protocol}//${host}${path}`\n\n      let callback = args.callback\n\n      const method = (options.method || 'GET').toUpperCase()\n\n      const scope = tracer.scope()\n      const childOf = scope.active()\n      const type = config.filter(uri) ? REFERENCE_CHILD_OF : REFERENCE_NOOP\n      const span = tracer.startSpan('http.request', {\n        references: [\n          new Reference(type, childOf)\n        ],\n        tags: {\n          [SPAN_KIND]: CLIENT,\n          'service.name': getServiceName(tracer, config, options),\n          'resource.name': method,\n          'span.type': 'http',\n          'http.method': method,\n          'http.url': uri\n        }\n      })\n\n      if (!(hasAmazonSignature(options) || !config.propagationFilter(uri))) {\n        tracer.inject(span, HTTP_HEADERS, options.headers)\n      }\n\n      analyticsSampler.sample(span, config.measured)\n\n      callback = scope.bind(callback, childOf)\n\n      const req = scope.bind(request, span).call(this, options, callback)\n      const emit = req.emit\n\n      req.emit = function (eventName, arg) {\n        switch (eventName) {\n          case 'response': {\n            const res = arg\n\n            scope.bind(res)\n\n            res.on('end', () => finish(req, res, span, config))\n\n            break\n          }\n          case 'error':\n            addError(span, arg)\n          case 'abort': // eslint-disable-line no-fallthrough\n          case 'timeout': // eslint-disable-line no-fallthrough\n            finish(req, null, span, config)\n        }\n\n        return emit.apply(this, arguments)\n      }\n\n      scope.bind(req)\n\n      return req\n    }\n  }\n\n  function finish (req, res, span, config) {\n    if (res) {\n      span.setTag(HTTP_STATUS_CODE, res.statusCode)\n\n      if (!config.validateStatus(res.statusCode)) {\n        span.setTag('error', 1)\n      }\n\n      addResponseHeaders(res, span, config)\n    } else {\n      span.setTag('error', 1)\n    }\n\n    addRequestHeaders(req, span, config)\n\n    config.hooks.request(span, req, res)\n\n    span.finish()\n  }\n\n  function addError (span, error) {\n    span.addTags({\n      'error.type': error.name,\n      'error.msg': error.message,\n      'error.stack': error.stack\n    })\n\n    return error\n  }\n\n  function addRequestHeaders (req, span, config) {\n    config.headers.forEach(key => {\n      const value = req.getHeader(key)\n\n      if (value) {\n        span.setTag(`${HTTP_REQUEST_HEADERS}.${key}`, value)\n      }\n    })\n  }\n\n  function addResponseHeaders (res, span, config) {\n    config.headers.forEach(key => {\n      const value = res.headers[key]\n\n      if (value) {\n        span.setTag(`${HTTP_RESPONSE_HEADERS}.${key}`, value)\n      }\n    })\n  }\n\n  function normalizeArgs (inputURL, inputOptions, cb) {\n    inputURL = normalizeOptions(inputURL)\n\n    const [callback, inputOptionsNormalized] = normalizeCallback(inputOptions, cb, inputURL)\n    const options = combineOptions(inputURL, inputOptionsNormalized)\n    normalizeHeaders(options)\n    const uri = url.format(options)\n\n    return { uri, options, callback }\n  }\n\n  function normalizeCallback (inputOptions, callback, inputURL) {\n    if (typeof inputOptions === 'function') {\n      return [inputOptions, inputURL || {}]\n    } else {\n      return [callback, inputOptions]\n    }\n  }\n\n  function combineOptions (inputURL, inputOptions) {\n    if (typeof inputOptions === 'object') {\n      return Object.assign(inputURL || {}, inputOptions)\n    } else {\n      return inputURL\n    }\n  }\n\n  function normalizeHeaders (options) {\n    options.headers = options.headers || {}\n  }\n\n  // https://github.com/nodejs/node/blob/7e911d8b03a838e5ac6bb06c5b313533e89673ef/lib/internal/url.js#L1271\n  function urlToOptions (url) {\n    const agent = url.agent || http.globalAgent\n    const options = {\n      protocol: url.protocol || agent.protocol,\n      hostname: typeof url.hostname === 'string' && url.hostname.startsWith('[')\n        ? url.hostname.slice(1, -1)\n        : url.hostname ||\n        url.host ||\n        'localhost',\n      hash: url.hash,\n      search: url.search,\n      pathname: url.pathname,\n      path: `${url.pathname || ''}${url.search || ''}`,\n      href: url.href\n    }\n    if (url.port !== '') {\n      options.port = Number(url.port)\n    }\n    if (url.username || url.password) {\n      options.auth = `${url.username}:${url.password}`\n    }\n    return options\n  }\n\n  function normalizeOptions (inputURL) {\n    if (typeof inputURL === 'string') {\n      try {\n        return urlToOptions(new url.URL(inputURL))\n      } catch (e) {\n        return url.parse(inputURL)\n      }\n    } else if (inputURL instanceof url.URL) {\n      return urlToOptions(inputURL)\n    } else {\n      return inputURL\n    }\n  }\n}\n\nfunction getHost (options) {\n  if (typeof options === 'string') {\n    return url.parse(options).host\n  }\n\n  const hostname = options.hostname || options.host || 'localhost'\n  const port = options.port\n\n  return [hostname, port].filter(val => val).join(':')\n}\n\nfunction getServiceName (tracer, config, options) {\n  if (config.splitByDomain) {\n    return getHost(options)\n  } else if (config.service) {\n    return config.service\n  }\n\n  return `${tracer._service}-http-client`\n}\n\nfunction hasAmazonSignature (options) {\n  if (!options) {\n    return false\n  }\n\n  if (options.headers) {\n    const headers = Object.keys(options.headers)\n      .reduce((prev, next) => Object.assign(prev, {\n        [next.toLowerCase()]: options.headers[next]\n      }), {})\n\n    if (headers['x-amz-signature']) {\n      return true\n    }\n\n    if ([].concat(headers['authorization']).some(startsWith('AWS4-HMAC-SHA256'))) {\n      return true\n    }\n  }\n\n  return options.path && options.path.toLowerCase().indexOf('x-amz-signature=') !== -1\n}\n\nfunction startsWith (searchString) {\n  return value => String(value).startsWith(searchString)\n}\n\nfunction unpatch (http) {\n  this.unwrap(http, 'request')\n  this.unwrap(http, 'get')\n}\n\nfunction getStatusValidator (config) {\n  if (typeof config.validateStatus === 'function') {\n    return config.validateStatus\n  } else if (config.hasOwnProperty('validateStatus')) {\n    log.error('Expected `validateStatus` to be a function.')\n  }\n  return code => code < 400 || code >= 500\n}\n\nfunction getFilter (tracer, config) {\n  const blocklist = tracer._url ? [getAgentFilter(tracer._url)] : []\n\n  config = Object.assign({}, config, {\n    blocklist: blocklist.concat(config.blocklist || [])\n  })\n\n  return urlFilter.getFilter(config)\n}\n\nfunction getAgentFilter (url) {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Escaping\n  const agentFilter = url.href.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n\n  return RegExp(`^${agentFilter}.*$`, 'i')\n}\n\nfunction normalizeConfig (tracer, config) {\n  config = config.client || config\n\n  const validateStatus = getStatusValidator(config)\n  const filter = getFilter(tracer, config)\n  const propagationFilter = getFilter(tracer, { blocklist: config.propagationBlocklist })\n  const headers = getHeaders(config)\n  const hooks = getHooks(config)\n\n  return Object.assign({}, config, {\n    validateStatus,\n    filter,\n    propagationFilter,\n    headers,\n    hooks\n  })\n}\n\nfunction getHeaders (config) {\n  if (!Array.isArray(config.headers)) return []\n\n  return config.headers\n    .filter(key => typeof key === 'string')\n    .map(key => key.toLowerCase())\n}\n\nfunction getHooks (config) {\n  const noop = () => {}\n  const request = (config.hooks && config.hooks.request) || noop\n\n  return { request }\n}\n\nmodule.exports = [\n  {\n    name: 'http',\n    patch: function (http, tracer, config) {\n      if (config.client === false) return\n\n      patch.call(this, http, 'request', tracer, config)\n      /**\n       * References internal to modules, such as `http(s).get` calling\n       * `http(s).request`, do not use externally patched versions, which is\n       * why we need to also patch `get` here separately.\n       */\n      patch.call(this, http, 'get', tracer, config)\n    },\n    unpatch\n  },\n  {\n    name: 'https',\n    patch: function (http, tracer, config) {\n      if (config.client === false) return\n\n      patch.call(this, http, 'request', tracer, config)\n      patch.call(this, http, 'get', tracer, config)\n    },\n    unpatch\n  }\n]\n"]},"metadata":{},"sourceType":"script"}