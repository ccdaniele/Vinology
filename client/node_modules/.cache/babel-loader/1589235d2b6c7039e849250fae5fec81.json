{"ast":null,"code":"'use strict';\n\nconst URL = require('url').URL;\n\nconst log = require('../../log');\n\nconst Writer = require('./writer');\n\nconst Scheduler = require('./scheduler');\n\nclass AgentExporter {\n  constructor({\n    url,\n    hostname,\n    port,\n    flushInterval,\n    lookup,\n    protocolVersion\n  }, prioritySampler) {\n    this._url = url || new URL(`http://${hostname || 'localhost'}:${port}`);\n    this._writer = new Writer({\n      url: this._url,\n      prioritySampler,\n      lookup,\n      protocolVersion\n    });\n\n    if (flushInterval > 0) {\n      this._scheduler = new Scheduler(() => this._writer.flush(), flushInterval);\n    }\n\n    this._scheduler && this._scheduler.start();\n  }\n\n  setUrl(url) {\n    try {\n      url = new URL(url);\n      this._url = url;\n\n      this._writer.setUrl(url);\n    } catch (e) {\n      log.warn(e.stack);\n    }\n  }\n\n  export(spans) {\n    this._writer.append(spans);\n\n    if (!this._scheduler) {\n      this._writer.flush();\n    }\n  }\n\n}\n\nmodule.exports = AgentExporter;","map":{"version":3,"sources":["/Users/danielcalderon/vinology/Vinology-client/node_modules/dd-trace/packages/dd-trace/src/exporters/agent/index.js"],"names":["URL","require","log","Writer","Scheduler","AgentExporter","constructor","url","hostname","port","flushInterval","lookup","protocolVersion","prioritySampler","_url","_writer","_scheduler","flush","start","setUrl","e","warn","stack","export","spans","append","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,GAAG,GAAGC,OAAO,CAAC,KAAD,CAAP,CAAeD,GAA3B;;AACA,MAAME,GAAG,GAAGD,OAAO,CAAC,WAAD,CAAnB;;AACA,MAAME,MAAM,GAAGF,OAAO,CAAC,UAAD,CAAtB;;AACA,MAAMG,SAAS,GAAGH,OAAO,CAAC,aAAD,CAAzB;;AAEA,MAAMI,aAAN,CAAoB;AAClBC,EAAAA,WAAW,CAAE;AAAEC,IAAAA,GAAF;AAAOC,IAAAA,QAAP;AAAiBC,IAAAA,IAAjB;AAAuBC,IAAAA,aAAvB;AAAsCC,IAAAA,MAAtC;AAA8CC,IAAAA;AAA9C,GAAF,EAAmEC,eAAnE,EAAoF;AAC7F,SAAKC,IAAL,GAAYP,GAAG,IAAI,IAAIP,GAAJ,CAAS,UAASQ,QAAQ,IAAI,WAAY,IAAGC,IAAK,EAAlD,CAAnB;AACA,SAAKM,OAAL,GAAe,IAAIZ,MAAJ,CAAW;AAAEI,MAAAA,GAAG,EAAE,KAAKO,IAAZ;AAAkBD,MAAAA,eAAlB;AAAmCF,MAAAA,MAAnC;AAA2CC,MAAAA;AAA3C,KAAX,CAAf;;AAEA,QAAIF,aAAa,GAAG,CAApB,EAAuB;AACrB,WAAKM,UAAL,GAAkB,IAAIZ,SAAJ,CAAc,MAAM,KAAKW,OAAL,CAAaE,KAAb,EAApB,EAA0CP,aAA1C,CAAlB;AACD;;AACD,SAAKM,UAAL,IAAmB,KAAKA,UAAL,CAAgBE,KAAhB,EAAnB;AACD;;AAEDC,EAAAA,MAAM,CAAEZ,GAAF,EAAO;AACX,QAAI;AACFA,MAAAA,GAAG,GAAG,IAAIP,GAAJ,CAAQO,GAAR,CAAN;AACA,WAAKO,IAAL,GAAYP,GAAZ;;AACA,WAAKQ,OAAL,CAAaI,MAAb,CAAoBZ,GAApB;AACD,KAJD,CAIE,OAAOa,CAAP,EAAU;AACVlB,MAAAA,GAAG,CAACmB,IAAJ,CAASD,CAAC,CAACE,KAAX;AACD;AACF;;AAEDC,EAAAA,MAAM,CAAEC,KAAF,EAAS;AACb,SAAKT,OAAL,CAAaU,MAAb,CAAoBD,KAApB;;AAEA,QAAI,CAAC,KAAKR,UAAV,EAAsB;AACpB,WAAKD,OAAL,CAAaE,KAAb;AACD;AACF;;AA3BiB;;AA8BpBS,MAAM,CAACC,OAAP,GAAiBtB,aAAjB","sourcesContent":["'use strict'\n\nconst URL = require('url').URL\nconst log = require('../../log')\nconst Writer = require('./writer')\nconst Scheduler = require('./scheduler')\n\nclass AgentExporter {\n  constructor ({ url, hostname, port, flushInterval, lookup, protocolVersion }, prioritySampler) {\n    this._url = url || new URL(`http://${hostname || 'localhost'}:${port}`)\n    this._writer = new Writer({ url: this._url, prioritySampler, lookup, protocolVersion })\n\n    if (flushInterval > 0) {\n      this._scheduler = new Scheduler(() => this._writer.flush(), flushInterval)\n    }\n    this._scheduler && this._scheduler.start()\n  }\n\n  setUrl (url) {\n    try {\n      url = new URL(url)\n      this._url = url\n      this._writer.setUrl(url)\n    } catch (e) {\n      log.warn(e.stack)\n    }\n  }\n\n  export (spans) {\n    this._writer.append(spans)\n\n    if (!this._scheduler) {\n      this._writer.flush()\n    }\n  }\n}\n\nmodule.exports = AgentExporter\n"]},"metadata":{},"sourceType":"script"}