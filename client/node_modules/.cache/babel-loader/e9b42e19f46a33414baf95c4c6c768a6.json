{"ast":null,"code":"'use strict';\n\nconst limiter = require('limiter');\n\nclass RateLimiter {\n  constructor(rateLimit) {\n    this._rateLimit = parseInt(rateLimit);\n    this._limiter = new limiter.RateLimiter(this._rateLimit, 'second');\n    this._tokensRequested = 0;\n    this._prevIntervalTokens = 0;\n    this._prevTokensRequested = 0;\n  }\n\n  isAllowed() {\n    const curIntervalStart = this._limiter.curIntervalStart;\n    const curIntervalTokens = this._limiter.tokensThisInterval;\n\n    const allowed = this._isAllowed();\n\n    if (curIntervalStart !== this._limiter.curIntervalStart) {\n      this._prevIntervalTokens = curIntervalTokens;\n      this._prevTokensRequested = this._tokensRequested;\n      this._tokensRequested = 1;\n    } else {\n      this._tokensRequested++;\n    }\n\n    return allowed;\n  }\n\n  effectiveRate() {\n    if (this._rateLimit < 0) return 1;\n    if (this._rateLimit === 0) return 0;\n    if (this._tokensRequested === 0) return 1;\n    const allowed = this._prevIntervalTokens + this._limiter.tokensThisInterval;\n    const requested = this._prevTokensRequested + this._tokensRequested;\n    return allowed / requested;\n  }\n\n  _isAllowed() {\n    if (this._rateLimit < 0) return true;\n    if (this._rateLimit === 0) return false;\n    return this._limiter.tryRemoveTokens(1);\n  }\n\n  _currentWindowRate() {\n    if (this._rateLimit < 0) return 1;\n    if (this._rateLimit === 0) return 0;\n    if (this._tokensRequested === 0) return 1;\n    return this._limiter.tokensThisInterval / this._tokensRequested;\n  }\n\n}\n\nmodule.exports = RateLimiter;","map":{"version":3,"sources":["/Users/danielcalderon/vinology/Vinology-client/node_modules/dd-trace/packages/dd-trace/src/rate_limiter.js"],"names":["limiter","require","RateLimiter","constructor","rateLimit","_rateLimit","parseInt","_limiter","_tokensRequested","_prevIntervalTokens","_prevTokensRequested","isAllowed","curIntervalStart","curIntervalTokens","tokensThisInterval","allowed","_isAllowed","effectiveRate","requested","tryRemoveTokens","_currentWindowRate","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AAEA,MAAMC,WAAN,CAAkB;AAChBC,EAAAA,WAAW,CAAEC,SAAF,EAAa;AACtB,SAAKC,UAAL,GAAkBC,QAAQ,CAACF,SAAD,CAA1B;AACA,SAAKG,QAAL,GAAgB,IAAIP,OAAO,CAACE,WAAZ,CAAwB,KAAKG,UAA7B,EAAyC,QAAzC,CAAhB;AACA,SAAKG,gBAAL,GAAwB,CAAxB;AACA,SAAKC,mBAAL,GAA2B,CAA3B;AACA,SAAKC,oBAAL,GAA4B,CAA5B;AACD;;AAEDC,EAAAA,SAAS,GAAI;AACX,UAAMC,gBAAgB,GAAG,KAAKL,QAAL,CAAcK,gBAAvC;AACA,UAAMC,iBAAiB,GAAG,KAAKN,QAAL,CAAcO,kBAAxC;;AACA,UAAMC,OAAO,GAAG,KAAKC,UAAL,EAAhB;;AAEA,QAAIJ,gBAAgB,KAAK,KAAKL,QAAL,CAAcK,gBAAvC,EAAyD;AACvD,WAAKH,mBAAL,GAA2BI,iBAA3B;AACA,WAAKH,oBAAL,GAA4B,KAAKF,gBAAjC;AACA,WAAKA,gBAAL,GAAwB,CAAxB;AACD,KAJD,MAIO;AACL,WAAKA,gBAAL;AACD;;AAED,WAAOO,OAAP;AACD;;AAEDE,EAAAA,aAAa,GAAI;AACf,QAAI,KAAKZ,UAAL,GAAkB,CAAtB,EAAyB,OAAO,CAAP;AACzB,QAAI,KAAKA,UAAL,KAAoB,CAAxB,EAA2B,OAAO,CAAP;AAC3B,QAAI,KAAKG,gBAAL,KAA0B,CAA9B,EAAiC,OAAO,CAAP;AAEjC,UAAMO,OAAO,GAAG,KAAKN,mBAAL,GAA2B,KAAKF,QAAL,CAAcO,kBAAzD;AACA,UAAMI,SAAS,GAAG,KAAKR,oBAAL,GAA4B,KAAKF,gBAAnD;AAEA,WAAOO,OAAO,GAAGG,SAAjB;AACD;;AAEDF,EAAAA,UAAU,GAAI;AACZ,QAAI,KAAKX,UAAL,GAAkB,CAAtB,EAAyB,OAAO,IAAP;AACzB,QAAI,KAAKA,UAAL,KAAoB,CAAxB,EAA2B,OAAO,KAAP;AAE3B,WAAO,KAAKE,QAAL,CAAcY,eAAd,CAA8B,CAA9B,CAAP;AACD;;AAEDC,EAAAA,kBAAkB,GAAI;AACpB,QAAI,KAAKf,UAAL,GAAkB,CAAtB,EAAyB,OAAO,CAAP;AACzB,QAAI,KAAKA,UAAL,KAAoB,CAAxB,EAA2B,OAAO,CAAP;AAC3B,QAAI,KAAKG,gBAAL,KAA0B,CAA9B,EAAiC,OAAO,CAAP;AAEjC,WAAO,KAAKD,QAAL,CAAcO,kBAAd,GAAmC,KAAKN,gBAA/C;AACD;;AAjDe;;AAoDlBa,MAAM,CAACC,OAAP,GAAiBpB,WAAjB","sourcesContent":["'use strict'\n\nconst limiter = require('limiter')\n\nclass RateLimiter {\n  constructor (rateLimit) {\n    this._rateLimit = parseInt(rateLimit)\n    this._limiter = new limiter.RateLimiter(this._rateLimit, 'second')\n    this._tokensRequested = 0\n    this._prevIntervalTokens = 0\n    this._prevTokensRequested = 0\n  }\n\n  isAllowed () {\n    const curIntervalStart = this._limiter.curIntervalStart\n    const curIntervalTokens = this._limiter.tokensThisInterval\n    const allowed = this._isAllowed()\n\n    if (curIntervalStart !== this._limiter.curIntervalStart) {\n      this._prevIntervalTokens = curIntervalTokens\n      this._prevTokensRequested = this._tokensRequested\n      this._tokensRequested = 1\n    } else {\n      this._tokensRequested++\n    }\n\n    return allowed\n  }\n\n  effectiveRate () {\n    if (this._rateLimit < 0) return 1\n    if (this._rateLimit === 0) return 0\n    if (this._tokensRequested === 0) return 1\n\n    const allowed = this._prevIntervalTokens + this._limiter.tokensThisInterval\n    const requested = this._prevTokensRequested + this._tokensRequested\n\n    return allowed / requested\n  }\n\n  _isAllowed () {\n    if (this._rateLimit < 0) return true\n    if (this._rateLimit === 0) return false\n\n    return this._limiter.tryRemoveTokens(1)\n  }\n\n  _currentWindowRate () {\n    if (this._rateLimit < 0) return 1\n    if (this._rateLimit === 0) return 0\n    if (this._tokensRequested === 0) return 1\n\n    return this._limiter.tokensThisInterval / this._tokensRequested\n  }\n}\n\nmodule.exports = RateLimiter\n"]},"metadata":{},"sourceType":"script"}