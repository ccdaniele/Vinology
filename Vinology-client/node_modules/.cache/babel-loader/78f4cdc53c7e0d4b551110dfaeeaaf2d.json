{"ast":null,"code":"'use strict';\n\nconst log = require('../../../dd-trace/src/log');\n\nclass Lambda {\n  generateTags(params, operation, response) {\n    const tags = {};\n    if (!params || !params.FunctionName) return tags;\n    return Object.assign(tags, {\n      'resource.name': `${operation} ${params.FunctionName}`,\n      'aws.lambda': params.FunctionName\n    });\n  }\n\n  requestInject(span, request, tracer) {\n    const operation = request.operation;\n\n    if (operation === 'invoke') {\n      if (!request.params) {\n        request.params = {};\n      }\n\n      const isSyncInvocation = !request.params.InvocationType || request.params.InvocationType === 'RequestResponse';\n\n      if (isSyncInvocation) {\n        try {\n          // Check to see if there's already a config on the request\n          let clientContext = {};\n\n          if (request.params.ClientContext) {\n            const clientContextJson = Buffer.from(request.params.ClientContext, 'base64').toString('utf-8');\n            clientContext = JSON.parse(clientContextJson);\n          }\n\n          if (!clientContext.custom) {\n            clientContext.custom = {};\n          }\n\n          tracer.inject(span, 'text_map', clientContext.custom);\n          const newContextBase64 = Buffer.from(JSON.stringify(clientContext)).toString('base64');\n          request.params.ClientContext = newContextBase64;\n        } catch (err) {\n          log.error(err);\n        }\n      }\n    }\n  }\n\n}\n\nmodule.exports = Lambda;","map":{"version":3,"sources":["/Users/danielcalderon/vinology/Vinology-client/node_modules/dd-trace/packages/datadog-plugin-aws-sdk/src/services/lambda.js"],"names":["log","require","Lambda","generateTags","params","operation","response","tags","FunctionName","Object","assign","requestInject","span","request","tracer","isSyncInvocation","InvocationType","clientContext","ClientContext","clientContextJson","Buffer","from","toString","JSON","parse","custom","inject","newContextBase64","stringify","err","error","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,GAAG,GAAGC,OAAO,CAAC,2BAAD,CAAnB;;AAEA,MAAMC,MAAN,CAAa;AACXC,EAAAA,YAAY,CAAEC,MAAF,EAAUC,SAAV,EAAqBC,QAArB,EAA+B;AACzC,UAAMC,IAAI,GAAG,EAAb;AAEA,QAAI,CAACH,MAAD,IAAW,CAACA,MAAM,CAACI,YAAvB,EAAqC,OAAOD,IAAP;AAErC,WAAOE,MAAM,CAACC,MAAP,CAAcH,IAAd,EAAoB;AACzB,uBAAkB,GAAEF,SAAU,IAAGD,MAAM,CAACI,YAAa,EAD5B;AAEzB,oBAAcJ,MAAM,CAACI;AAFI,KAApB,CAAP;AAID;;AAEDG,EAAAA,aAAa,CAAEC,IAAF,EAAQC,OAAR,EAAiBC,MAAjB,EAAyB;AACpC,UAAMT,SAAS,GAAGQ,OAAO,CAACR,SAA1B;;AACA,QAAIA,SAAS,KAAK,QAAlB,EAA4B;AAC1B,UAAI,CAACQ,OAAO,CAACT,MAAb,EAAqB;AACnBS,QAAAA,OAAO,CAACT,MAAR,GAAiB,EAAjB;AACD;;AAED,YAAMW,gBAAgB,GAAG,CAACF,OAAO,CAACT,MAAR,CAAeY,cAAhB,IACvBH,OAAO,CAACT,MAAR,CAAeY,cAAf,KAAkC,iBADpC;;AAGA,UAAID,gBAAJ,EAAsB;AACpB,YAAI;AACF;AACA,cAAIE,aAAa,GAAG,EAApB;;AACA,cAAIJ,OAAO,CAACT,MAAR,CAAec,aAAnB,EAAkC;AAChC,kBAAMC,iBAAiB,GAAGC,MAAM,CAACC,IAAP,CAAYR,OAAO,CAACT,MAAR,CAAec,aAA3B,EAA0C,QAA1C,EAAoDI,QAApD,CAA6D,OAA7D,CAA1B;AACAL,YAAAA,aAAa,GAAGM,IAAI,CAACC,KAAL,CAAWL,iBAAX,CAAhB;AACD;;AACD,cAAI,CAACF,aAAa,CAACQ,MAAnB,EAA2B;AACzBR,YAAAA,aAAa,CAACQ,MAAd,GAAuB,EAAvB;AACD;;AACDX,UAAAA,MAAM,CAACY,MAAP,CAAcd,IAAd,EAAoB,UAApB,EAAgCK,aAAa,CAACQ,MAA9C;AACA,gBAAME,gBAAgB,GAAGP,MAAM,CAACC,IAAP,CAAYE,IAAI,CAACK,SAAL,CAAeX,aAAf,CAAZ,EAA2CK,QAA3C,CAAoD,QAApD,CAAzB;AACAT,UAAAA,OAAO,CAACT,MAAR,CAAec,aAAf,GAA+BS,gBAA/B;AACD,SAbD,CAaE,OAAOE,GAAP,EAAY;AACZ7B,UAAAA,GAAG,CAAC8B,KAAJ,CAAUD,GAAV;AACD;AACF;AACF;AACF;;AAzCU;;AA4CbE,MAAM,CAACC,OAAP,GAAiB9B,MAAjB","sourcesContent":["'use strict'\n\nconst log = require('../../../dd-trace/src/log')\n\nclass Lambda {\n  generateTags (params, operation, response) {\n    const tags = {}\n\n    if (!params || !params.FunctionName) return tags\n\n    return Object.assign(tags, {\n      'resource.name': `${operation} ${params.FunctionName}`,\n      'aws.lambda': params.FunctionName\n    })\n  }\n\n  requestInject (span, request, tracer) {\n    const operation = request.operation\n    if (operation === 'invoke') {\n      if (!request.params) {\n        request.params = {}\n      }\n\n      const isSyncInvocation = !request.params.InvocationType ||\n        request.params.InvocationType === 'RequestResponse'\n\n      if (isSyncInvocation) {\n        try {\n          // Check to see if there's already a config on the request\n          let clientContext = {}\n          if (request.params.ClientContext) {\n            const clientContextJson = Buffer.from(request.params.ClientContext, 'base64').toString('utf-8')\n            clientContext = JSON.parse(clientContextJson)\n          }\n          if (!clientContext.custom) {\n            clientContext.custom = {}\n          }\n          tracer.inject(span, 'text_map', clientContext.custom)\n          const newContextBase64 = Buffer.from(JSON.stringify(clientContext)).toString('base64')\n          request.params.ClientContext = newContextBase64\n        } catch (err) {\n          log.error(err)\n        }\n      }\n    }\n  }\n}\n\nmodule.exports = Lambda\n"]},"metadata":{},"sourceType":"script"}