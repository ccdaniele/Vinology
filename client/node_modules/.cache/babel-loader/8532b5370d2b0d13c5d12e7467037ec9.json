{"ast":null,"code":"'use strict';\n\nclass NativeCpuProfiler {\n  constructor(options = {}) {\n    this.type = 'wall';\n    this._samplingInterval = options.samplingInterval || 10 * 1000;\n    this._mapper = undefined;\n    this._pprof = undefined;\n  }\n\n  start({\n    mapper\n  } = {}) {\n    this._mapper = mapper;\n    this._pprof = require('@datadog/pprof'); // pprof otherwise crashes in worker threads\n\n    if (!process._startProfilerIdleNotifier) {\n      process._startProfilerIdleNotifier = () => {};\n    }\n\n    if (!process._stopProfilerIdleNotifier) {\n      process._stopProfilerIdleNotifier = () => {};\n    }\n\n    this._record();\n  }\n\n  profile() {\n    if (!this._stop) return;\n    return this._stop(true);\n  }\n\n  encode(profile) {\n    return this._pprof.encode(profile);\n  }\n\n  stop() {\n    if (!this._stop) return;\n\n    this._stop();\n  }\n\n  _record() {\n    this._stop = this._pprof.time.start(this._samplingInterval, null, this._mapper);\n  }\n\n}\n\nmodule.exports = NativeCpuProfiler;","map":{"version":3,"sources":["/Users/danielcalderon/vinology/Vinology-client/node_modules/dd-trace/packages/dd-trace/src/profiling/profilers/cpu.js"],"names":["NativeCpuProfiler","constructor","options","type","_samplingInterval","samplingInterval","_mapper","undefined","_pprof","start","mapper","require","process","_startProfilerIdleNotifier","_stopProfilerIdleNotifier","_record","profile","_stop","encode","stop","time","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,iBAAN,CAAwB;AACtBC,EAAAA,WAAW,CAAEC,OAAO,GAAG,EAAZ,EAAgB;AACzB,SAAKC,IAAL,GAAY,MAAZ;AACA,SAAKC,iBAAL,GAAyBF,OAAO,CAACG,gBAAR,IAA4B,KAAK,IAA1D;AACA,SAAKC,OAAL,GAAeC,SAAf;AACA,SAAKC,MAAL,GAAcD,SAAd;AACD;;AAEDE,EAAAA,KAAK,CAAE;AAAEC,IAAAA;AAAF,MAAa,EAAf,EAAmB;AACtB,SAAKJ,OAAL,GAAeI,MAAf;AACA,SAAKF,MAAL,GAAcG,OAAO,CAAC,gBAAD,CAArB,CAFsB,CAItB;;AACA,QAAI,CAACC,OAAO,CAACC,0BAAb,EAAyC;AACvCD,MAAAA,OAAO,CAACC,0BAAR,GAAqC,MAAM,CAAE,CAA7C;AACD;;AACD,QAAI,CAACD,OAAO,CAACE,yBAAb,EAAwC;AACtCF,MAAAA,OAAO,CAACE,yBAAR,GAAoC,MAAM,CAAE,CAA5C;AACD;;AAED,SAAKC,OAAL;AACD;;AAEDC,EAAAA,OAAO,GAAI;AACT,QAAI,CAAC,KAAKC,KAAV,EAAiB;AACjB,WAAO,KAAKA,KAAL,CAAW,IAAX,CAAP;AACD;;AAEDC,EAAAA,MAAM,CAAEF,OAAF,EAAW;AACf,WAAO,KAAKR,MAAL,CAAYU,MAAZ,CAAmBF,OAAnB,CAAP;AACD;;AAEDG,EAAAA,IAAI,GAAI;AACN,QAAI,CAAC,KAAKF,KAAV,EAAiB;;AACjB,SAAKA,KAAL;AACD;;AAEDF,EAAAA,OAAO,GAAI;AACT,SAAKE,KAAL,GAAa,KAAKT,MAAL,CAAYY,IAAZ,CAAiBX,KAAjB,CAAuB,KAAKL,iBAA5B,EAA+C,IAA/C,EACX,KAAKE,OADM,CAAb;AAED;;AAxCqB;;AA2CxBe,MAAM,CAACC,OAAP,GAAiBtB,iBAAjB","sourcesContent":["'use strict'\n\nclass NativeCpuProfiler {\n  constructor (options = {}) {\n    this.type = 'wall'\n    this._samplingInterval = options.samplingInterval || 10 * 1000\n    this._mapper = undefined\n    this._pprof = undefined\n  }\n\n  start ({ mapper } = {}) {\n    this._mapper = mapper\n    this._pprof = require('@datadog/pprof')\n\n    // pprof otherwise crashes in worker threads\n    if (!process._startProfilerIdleNotifier) {\n      process._startProfilerIdleNotifier = () => {}\n    }\n    if (!process._stopProfilerIdleNotifier) {\n      process._stopProfilerIdleNotifier = () => {}\n    }\n\n    this._record()\n  }\n\n  profile () {\n    if (!this._stop) return\n    return this._stop(true)\n  }\n\n  encode (profile) {\n    return this._pprof.encode(profile)\n  }\n\n  stop () {\n    if (!this._stop) return\n    this._stop()\n  }\n\n  _record () {\n    this._stop = this._pprof.time.start(this._samplingInterval, null,\n      this._mapper)\n  }\n}\n\nmodule.exports = NativeCpuProfiler\n"]},"metadata":{},"sourceType":"script"}